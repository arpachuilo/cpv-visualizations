<!DOCTYPE html>
<head>
  <meta charset='utf-8'>
  <script src='https://d3js.org/d3.v4.min.js'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/moment-duration-format/1.3.0/moment-duration-format.js'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.js'></script>

  <script src='./data/video-links.js'></script>

  <script src='./scripts/util.js'></script>
  <script src='./scripts/Tooltip.js'></script>
  <script src='./scripts/drawBbox.js'></script>
  <script src='./scripts/VideoHeatmap.js'></script>


  <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
  <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/skeleton/2.0.4/skeleton.css'>
  <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css'>
  <link rel='stylesheet' href='style.css'>

  <title>Cyber Prov Vis</title>
</head>
<body onresize='resize()'>

  <div id='loader' class='loading'>Loading&#8230;</div>

  <ul id='nav'>
    <li class='nav-item'><a class='active' href='VideoHeatmap.html'>Video Heatmap</a></li>
    <li class='nav-item'><a href='OverviewDetail.html'>Overview</a></li>
    <li class='nav-item-right'>
      <span>Dataset</span>
      <select class='dd' id='dataset' onchange='switchSet()'>
        <option value='0'>CPV-C</option>
        <option value='1'>CPV-D</option>
        <option value='2'>CPV-E</option>
        <option value='3'>CPV-F</option>
        <option value='4'>CPV-G</option>
        <option value='5'>CPV-H</option>
        <option value='6'>CPV-I</option>
        <option value='7'>CPV-J</option>
      </select>
    </li>
  </ul>

  <div id='video-container' class='row' style='position: relative; margin: 0 auto;'>
    <video id='user-video'>
      <source id='user-video-source' type='video/mp4'></source>
    </video>
    <canvas id='video-overlay'></canvas>
  </div>

</body>
<script>
  var ids = ['CPV-C', 'CPV-D', 'CPV-E', 'CPV-F', 'CPV-G', 'CPV-G', 'CPV-I', 'CPV-J']
  var videoHeatmap = VideoHeatmap(document.getElementById('video-overlay'), document.getElementById('user-video'))

  var data = {}

  document.addEventListener('loaded', function () {
    var video = document.getElementById('user-video')
    video.pause()

    var videoSource = document.getElementById('user-video-source')
    videoSource.setAttribute('src', 'https://youtu.be/9EvbqxBUG_c')
    videoHeatmap
      .setEyeData(data.loadedEye)
      .setMouseData(data.loadedMouse)
    document.getElementById('loader').style.display = 'none'
  })

  function switchSet () {
    load(+document.getElementById('dataset').value)
  }

  function load (index) {
    d3.text('data/eye/' + ids[index] + '.csv', function(eye) {
      data.loadedEye = d3.csvParse('status,x,y,time,aoi\n' + eye)
      d3.json('data/mouse/' + ids[index] + '.json', function (mouse) {
        data.loadedMouse = mouse

        document.dispatchEvent(new Event('loaded'))
      })
    })
  }
  document.getElementById('loader').style.display = 'none'
  load(0)
</script>
